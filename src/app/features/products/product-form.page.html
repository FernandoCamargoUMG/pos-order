<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/products"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ isEditMode ? 'Editar Producto' : 'Nuevo Producto' }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="goBack()">
        <ion-icon slot="icon-only" name="close-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
    <ion-list>
      <ion-item>
        <ion-label position="stacked">Nombre *</ion-label>
        <ion-input
          formControlName="name"
          type="text"
          placeholder="Ej: Hamburguesa Clásica"
          required>
        </ion-input>
      </ion-item>
      <div *ngIf="productForm.get('name')?.invalid && productForm.get('name')?.touched" 
           style="color: var(--ion-color-danger); font-size: 12px; padding: 8px 16px;">
        El nombre es requerido (mínimo 2 caracteres)
      </div>

      <ion-item>
        <ion-label position="stacked">Precio (Q) *</ion-label>
        <ion-input
          formControlName="price"
          type="number"
          placeholder="0.00"
          step="0.01"
          min="0"
          required>
        </ion-input>
      </ion-item>
      <div *ngIf="productForm.get('price')?.invalid && productForm.get('price')?.touched" 
           style="color: var(--ion-color-danger); font-size: 12px; padding: 8px 16px;">
        El precio debe ser mayor a 0
      </div>

      <ion-item>
        <ion-label position="stacked">Categoría</ion-label>
        <ion-select 
          formControlName="category" 
          placeholder="Selecciona una categoría"
          (ionChange)="onCategoryChange($event)">
          <ion-select-option *ngFor="let cat of categories" [value]="cat">
            {{ cat }}
          </ion-select-option>
          <ion-select-option value="custom">+ Nueva categoría</ion-select-option>
        </ion-select>
      </ion-item>

      <ion-item *ngIf="customCategory">
        <ion-label position="stacked">Nueva Categoría</ion-label>
        <ion-input
          formControlName="customCategory"
          type="text"
          placeholder="Escribe el nombre de la categoría">
        </ion-input>
      </ion-item>

      <ion-item>
        <ion-label>Producto Activo</ion-label>
        <ion-toggle formControlName="active" slot="end"></ion-toggle>
      </ion-item>
    </ion-list>

    <div style="padding: 16px;">
      <ion-button expand="block" type="submit" [disabled]="productForm.invalid">
        <ion-icon slot="start" name="save-outline"></ion-icon>
        {{ isEditMode ? 'Actualizar' : 'Guardar' }} Producto
      </ion-button>
      <ion-button expand="block" fill="outline" (click)="goBack()" style="margin-top: 8px;">
        Cancelar
      </ion-button>
    </div>
  </form>
</ion-content>
